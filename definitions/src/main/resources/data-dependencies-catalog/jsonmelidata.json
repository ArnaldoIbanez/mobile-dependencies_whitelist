{
  "data": [
    {
      "users": [
        "matias.tencer@mercadolibre.com"
      ],
      "process_name": "tracks_count",
      "cron": "* 07 * * *",
      "extract": {
        "operation": "append",
        "columns": [
          {
            "name": "ds",
            "type": "DATE",
            "format": "yyyy-MM-dd"
          },
          {
            "name": "business",
            "type": "UNICODE_STRING"
          },
          {
            "name": "site",
            "type": "UNICODE_STRING"
          },
          {
            "name": "platform",
            "type": "UNICODE_STRING"
          },
          {
            "name": "total",
            "type": "INTEGER"
          }
        ],
        "sql": {
        
          "script": "select substr(ds, 1, 10) as ds, application.business, application.site_id as site, device.platform, count(1) as total from tracks where ds >= '@param01' and ds < '@param02' group by substr(ds, 1, 10), application.business, application.site_id, device.platform",
          "parameters": [
            {
              "name": "param01",
              "value": "DAY-1",
              "format": "yyyy-MM-dd"
            },
            {
              "name": "param02",
              "value": "DAY-0",
              "format": "yyyy-MM-dd"
            }
          ]
        }
      }
    },
    {
      "users": [
        "martin.ciruzzi@mercadolibre.com",
        "melidata_dev@mercadolibre.com"
      ],
      "process_name": "orders_insight",
      "cron": "00 10 * * *",
      "extract": {
        "operation": "append",
        "columns": [
          {
            "name": "date_created",
            "type": "DATE",
            "format": "yyyy-MM-dd"
          },
          {
            "name": "site",
            "type": "UNICODE_STRING"
          },
          {
            "name": "platform",
            "type": "UNICODE_STRING"
          },
          {
            "name": "path",
            "type": "UNICODE_STRING"
          },
          {
            "name": "counter",
            "type": "INTEGER"
          }
        ],
        "sql": {
        
          "script": "select date_created, site,platform, path , count(1) as counter from (  select o.id as id , substr(o.date_created,1,10) as date_created, o.site as site ,o.platform as platform, o.status as status, t.path as path from orders o left join ( select get_json_object(event_data, '$.order_id') as order_id, path from tracks where ds >= '@param01' and ds < '@param02' and path='/orders/ordercreated' ) t  on (o.id = t.order_id) where substr(o.date_created,1,10)='@param03' ) a group by a.date_created, a.site,a.platform, a.path",
          "parameters": [
            {
              "name": "param01",
              "value": "DAY-3",
              "format": "yyyy-MM-dd"
            },
            {
              "name": "param03",
              "value": "DAY-2",
              "format": "yyyy-MM-dd"
            },
            {
              "name": "param02",
              "value": "DAY-1",
              "format": "yyyy-MM-dd"
            }
          ]
        }
      }
    },
    {
      "users": [
        "matias.tencer@mercadolibre.com"
      ],
      "process_name": "checkout_tpv",
      "cron": "00 11 * * *",
      "extract": {
        "operation": "overwrite",
        "columns": [
          {
            "name": "ds",
            "type": "DATE",
            "format": "yyyy-MM-dd"
          },
          {
            "name": "business",
            "type": "UNICODE_STRING"
          },
          {
            "name": "site",
            "type": "UNICODE_STRING"
          },
          {
            "name": "platform",
            "type": "UNICODE_STRING"
          },
          {
            "name": "experiment",
            "type": "UNICODE_STRING"
          },
          {
            "name": "variant",
            "type": "UNICODE_STRING"
          },
          {
            "name": "status",
            "type": "UNICODE_STRING"
          },
          {
            "name": "count",
            "type": "INTEGER"
          }
        ],
        "sql": {

          "script": "select ds, business, site, platform, experiment, variant, status, count(1) as count from (select tmp.*, orders.status from (select distinct substr(ds, 1, 10) ds, usr.user_id, application.business, application.site_id site, device.platform, experiment, variant, get_json_object(event_data, '$.order_id') order_id from tracks lateral view explode(experiments) t as experiment, variant where ds >= '@param01' and ds < '@param02' and get_json_object(event_data, '$.order_id') is not null) tmp inner join orders on order_id = orders.id) t group by ds, business, site, platform, experiment, variant, status",
          "parameters": [
            {
              "name": "param01",
              "value": "DAY-30",
              "format": "yyyy-MM-dd"
            },
            {
              "name": "param02",
              "value": "DAY-0",
              "format": "yyyy-MM-dd"
            }
          ]
        }
      }
    },
    {
      "users": [
        "jose.rozanec@mercadolibre.com",
        "estefania.louzau@mercadolibre.com"
      ],
      "process_name": "landingdeals",
      "cron": "0 */4 * * *",
      "extract": {
        "operation": "overwrite",
        "columns": [
          {
            "name": "site",
            "type": "UNICODE_STRING"
          },
          {
            "name": "fecha",
            "type": "DATE",
            "format": "yyyy-MM-dd"
          },
          {
            "name": "plataforma",
            "type": "UNICODE_STRING"
          },
          {
            "name": "dealid",
            "type": "UNICODE_STRING"
          },
          {
            "name": "custid",
            "type": "INTEGER"
          },
          {
            "name": "nickname",
            "type": "UNICODE_STRING"
          },
          {
            "name": "dealname",
            "type": "UNICODE_STRING"
          },
          {
            "name": "total",
            "type": "INTEGER"
          }
        ],
        "sql": {
          "script": "select * from (select todo.site, substr(todo.fecha,1,10), todo.plataforma, todo.deal_id, todo.custid, todo.nickname, case todo.deal_id when 'MLA104' then 'DEAL BEAUTY' when 'MLA108' then 'DEAL GADGETS' when 'MLA119' then 'DEAL ROCKER' when 'MLA90' then 'DEAL TIEMPO LIBRE' when 'MLA89' then 'DEAL PARTY' when 'MLA68' then 'DEAL SPORTY' when 'MLA72' then 'DEAL GEEK' when 'MLA73' then 'DEAL VINTAGE' when 'MLB66' then 'DEAL BEAUTY' when 'MLB67' then 'DEAL GADGETS' when 'MLB68' then 'DEAL ROCKER' when 'MLB65' then 'DEAL TIEMPO LIBRE' when 'MLB64' then 'DEAL PARTY' when 'MLB48' then 'DEAL SPORTY' when 'MLB49' then 'DEAL GEEK' when 'MLB50' then 'DEAL VINTAGE' when 'MLM86' then 'DEAL BEAUTY' when 'MLM88' then 'DEAL GADGETS' when 'MLM95' then 'DEAL ROCKER' when 'MLM79' then 'DEAL TIEMPO LIBRE' when 'MLM78' then 'DEAL PARTY' when 'MLM63' then 'DEAL SPORTY' when 'MLM65' then 'DEAL GEEK' when 'MLM66' then 'DEAL VINTAGE' when 'MLM83' then 'DEAL VIAJES' else todo.deal_id end as deal_name, count(1) as total from (select application.site_id as site, ds as fecha, device.platform as plataforma, v2.deal_id as deal_id, usr.user_id as custid, usr.user_nick as nickname from tracks LATERAL VIEW json_tuple(event_data, 'filters') v1 as filters LATERAL VIEW json_tuple(v1.filters, 'deal') v2 as deal_id where ds >= '@param01' and ds < '@param02' and application.site_id IN ('MLA', 'MLB', 'MLM') and application.business = 'mercadolibre' and path = '/search' and device.platform = '/mobile/android')todo group by todo.site, substr(todo.fecha,1,10), todo.plataforma, todo.deal_id, todo.custid, todo.nickname, case todo.deal_id when 'MLA104' then 'DEAL BEAUTY' when 'MLA108' then 'DEAL GADGETS' when 'MLA119' then 'DEAL ROCKER' when 'MLA90' then 'DEAL TIEMPO LIBRE' when 'MLA89' then 'DEAL PARTY' when 'MLA68' then 'DEAL SPORTY' when 'MLA72' then 'DEAL GEEK' when 'MLA73' then 'DEAL VINTAGE' when 'MLB66' then 'DEAL BEAUTY' when 'MLB67' then 'DEAL GADGETS' when 'MLB68' then 'DEAL ROCKER' when 'MLB65' then 'DEAL TIEMPO LIBRE' when 'MLB64' then 'DEAL PARTY' when 'MLB48' then 'DEAL SPORTY' when 'MLB49' then 'DEAL GEEK' when 'MLB50' then 'DEAL VINTAGE' when 'MLM86' then 'DEAL BEAUTY' when 'MLM88' then 'DEAL GADGETS' when 'MLM95' then 'DEAL ROCKER' when 'MLM79' then 'DEAL TIEMPO LIBRE' when 'MLM78' then 'DEAL PARTY' when 'MLM63' then 'DEAL SPORTY' when 'MLM65' then 'DEAL GEEK' when 'MLM66' then 'DEAL VINTAGE' when 'MLM83' then 'DEAL VIAJES' else todo.deal_id end)todo where deal_name like 'DEAL%' and custid is not null order by site, total desc",
          "parameters": [
            {
              "name": "param01",
              "value": "DAY-2",
              "format": "yyyy-MM-dd"
            },
            {
              "name": "param02",
              "value": "DAY-1",
              "format": "yyyy-MM-dd"
            }
          ]
        }
      }
    },
    {
      "users": [
        "jose.rozanec@mercadolibre.com",
        "estefania.louzau@mercadolibre.com"
      ],
      "process_name": "landingdeals hist",
      "cron": "* 08 * * *",
      "extract": {
        "operation": "append",
        "columns": [
          {
            "name": "site",
            "type": "UNICODE_STRING"
          },
          {
            "name": "fecha",
            "type": "DATE",
            "format": "yyyy-MM-dd"
          },
          {
            "name": "plataforma",
            "type": "UNICODE_STRING"
          },
          {
            "name": "dealid",
            "type": "UNICODE_STRING"
          },
          {
            "name": "custid",
            "type": "INTEGER"
          },
          {
            "name": "nickname",
            "type": "UNICODE_STRING"
          },
          {
            "name": "dealname",
            "type": "UNICODE_STRING"
          },
          {
            "name": "total",
            "type": "INTEGER"
          }
        ],
        "sql": {
          "script": "select * from (select todo.site, substr(todo.fecha,1,10), todo.plataforma, todo.deal_id, todo.custid, todo.nickname, case todo.deal_id when 'MLA104' then 'DEAL BEAUTY' when 'MLA108' then 'DEAL GADGETS' when 'MLA119' then 'DEAL ROCKER' when 'MLA90' then 'DEAL TIEMPO LIBRE' when 'MLA89' then 'DEAL PARTY' when 'MLA68' then 'DEAL SPORTY' when 'MLA72' then 'DEAL GEEK' when 'MLA73' then 'DEAL VINTAGE' when 'MLB66' then 'DEAL BEAUTY' when 'MLB67' then 'DEAL GADGETS' when 'MLB68' then 'DEAL ROCKER' when 'MLB65' then 'DEAL TIEMPO LIBRE' when 'MLB64' then 'DEAL PARTY' when 'MLB48' then 'DEAL SPORTY' when 'MLB49' then 'DEAL GEEK' when 'MLB50' then 'DEAL VINTAGE' when 'MLM86' then 'DEAL BEAUTY' when 'MLM88' then 'DEAL GADGETS' when 'MLM95' then 'DEAL ROCKER' when 'MLM79' then 'DEAL TIEMPO LIBRE' when 'MLM78' then 'DEAL PARTY' when 'MLM63' then 'DEAL SPORTY' when 'MLM65' then 'DEAL GEEK' when 'MLM66' then 'DEAL VINTAGE' when 'MLM83' then 'DEAL VIAJES' else todo.deal_id end as deal_name, count(1) as total from (select application.site_id as site, ds as fecha, device.platform as plataforma, v2.deal_id as deal_id, usr.user_id as custid, usr.user_nick as nickname from tracks LATERAL VIEW json_tuple(event_data, 'filters') v1 as filters LATERAL VIEW json_tuple(v1.filters, 'deal') v2 as deal_id where ds >= '@param01' and ds < '@param02' and application.site_id IN ('MLA', 'MLB', 'MLM') and application.business = 'mercadolibre' and path = '/search' and device.platform = '/mobile/android')todo group by todo.site, substr(todo.fecha,1,10), todo.plataforma, todo.deal_id, todo.custid, todo.nickname, case todo.deal_id when 'MLA104' then 'DEAL BEAUTY' when 'MLA108' then 'DEAL GADGETS' when 'MLA119' then 'DEAL ROCKER' when 'MLA90' then 'DEAL TIEMPO LIBRE' when 'MLA89' then 'DEAL PARTY' when 'MLA68' then 'DEAL SPORTY' when 'MLA72' then 'DEAL GEEK' when 'MLA73' then 'DEAL VINTAGE' when 'MLB66' then 'DEAL BEAUTY' when 'MLB67' then 'DEAL GADGETS' when 'MLB68' then 'DEAL ROCKER' when 'MLB65' then 'DEAL TIEMPO LIBRE' when 'MLB64' then 'DEAL PARTY' when 'MLB48' then 'DEAL SPORTY' when 'MLB49' then 'DEAL GEEK' when 'MLB50' then 'DEAL VINTAGE' when 'MLM86' then 'DEAL BEAUTY' when 'MLM88' then 'DEAL GADGETS' when 'MLM95' then 'DEAL ROCKER' when 'MLM79' then 'DEAL TIEMPO LIBRE' when 'MLM78' then 'DEAL PARTY' when 'MLM63' then 'DEAL SPORTY' when 'MLM65' then 'DEAL GEEK' when 'MLM66' then 'DEAL VINTAGE' when 'MLM83' then 'DEAL VIAJES' else todo.deal_id end)todo where deal_name like 'DEAL%' and custid is not null order by site, total desc",
          "parameters": [
            {
              "name": "param01",
              "value": "DAY-3",
              "format": "yyyy-MM-dd"
            },
            {
              "name": "param02",
              "value": "DAY-2",
              "format": "yyyy-MM-dd"
            }
          ]
        }
      }
    }
  ]
}
