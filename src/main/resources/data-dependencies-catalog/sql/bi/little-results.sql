select todo.site_id, todo.category_path, todo.query, avg(todo.cant_resultados) as cant_resultados, count(1) as ocurrencias from (select application.site_id as site_id, v1.category_path as category_path, v1.query as query, v1.total as cant_resultados from tracks LATERAL VIEW json_tuple(event_data, 'query', 'category_path', 'total') v1 as query, category_path, total where ds >= 'AYER'  and ds < 'HOY' and path like '/search%' and device.platform = '/web/desktop' and application.site_id = 'MLM' and v1.category_path like '%MLM1430%' and cast(v1.total as double) < 48)todo where todo.query IS NOT NULL group by todo.site_id, todo.category_path, todo.query order by ocurrencias desc
